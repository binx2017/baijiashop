<extend name="Common/back"/>
<block name="content">
    <div id="content">
        <div class="page-header">
            <div class="container-fluid">
                <div class="pull-right">
                    <button type="submit" form="form-brand" data-toggle="tooltip" title="保存" class="btn btn-primary">
                        <i class="fa fa-save"></i>
                    </button>
                    <a href="{:U('list')}" data-toggle="tooltip" title="取消" class="btn btn-default">
                        <i class="fa fa-reply"></i>
                    </a>
                </div>
                <h1>属性</h1>
                <ul class="breadcrumb">
                    <li>
                        <a href="">首页</a>
                    </li>
                    <li>
                        <a href="">属性</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="container-fluid">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <i class="fa fa-pencil"></i>
                        编辑属性
                    </h3>
                </div>
                <div class="panel-body">
                    <form action="__SELF__" method="post" enctype="multipart/form-data" id="form-brand" class="form-horizontal">
                        <if condition="isset($data['attribute_id'])" >
                            <input type="hidden" name="attribute_id" value="{$data['attribute_id']}" id="input-attribute_id">
                        </if>
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#tab-general" data-toggle="tab">基本信息</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="tab-general">
                                                            <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-attribute_title">属性</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="attribute_title" value="{$data['attribute_title']}" placeholder="属性" id="input-attribute_title" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['attribute_title'])">
                                            <label for="input-attribute_title" class="text-danger">{$message['attribute_title']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-type_id">类型</label>
                                    <div class="col-sm-10">
                                        <select name="type_id" id="input-type_id" class="form-control" >
                                            <volist name="type_list" id="type">
                                                <option  value="{$type['type_id']}" <if condition="$type['type_id'] eq $data['type_id']">selected</if> >{$type.type_title}</option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['type_id'])">
                                            <label for="input-type_id" class="text-danger">{$message['type_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-input_type_id">输入类型</label>
                                    <div class="col-sm-10">
                                        <select class="form-control" name="input_type_id" id="input-input_type_id">
                                            <volist name="input_type_list" id="input_type">
                                                <option value="{$input_type['input_type_id']}"
                                                <if condition="$input_type['input_type_id'] eq $data['input_type_id']">selected</if> >{$input_type['type_title']}</option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['input_type_id'])">
                                            <label for="input-input_type_id" class="text-danger">{$message['input_type_id']}</label>
                                        </if>
                                    </div>
                                </div>


                                <div class="form-group" id="row-options">
                                    <label class="col-sm-2 control-label" for="input-sort_number">预设值</label>
                                    <div class="col-sm-10">
                                        <table id="table-options"
                                               class="table table-striped table-bordered table-hover">
                                            <thead>
                                            <tr>
                                                <td class="text-left">选项</td>
                                                <td class="text-left">排序</td>
                                                <td class="text-right">操作</td>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                <td class="text-left">
                                                    <input id="option-option_value" name="" value="" placeholder="选项" class="form-control" type="text">
                                                </td>
                                                <td class="text-left">
                                                    <input id="option-sort_number" name="" value="0" placeholder="排序" class="form-control" type="text">
                                                </td>
                                                <td class="text-right"><button class="btn btn-default" id="button-add">添加</button></td>
                                            </tr>

                                            <volist name="option_list" id="option">
                                                <tr>
                                                    <td class="text-left">
                                                        <input type="hidden" name="option[{$key}][attribute_option_id]" value="{$option['attribute_option_id']}">
                                                        <input name="option[{$key}][option_value]" value="{$option['option_value']}" placeholder="选项" class="form-control" type="text">
                                                    </td>
                                                    <td class="text-left">
                                                        <input name="option[{$key}][sort_number]" value="{$option['sort_number']}" placeholder="排序" class="form-control" type="text">
                                                    </td>
                                                    <td class="text-right"><button class="btn btn-default">删除</button></td></tr>
                                            </volist>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-sort_number">排序</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="sort_number" value="{$data['sort_number']}" placeholder="排序" id="input-sort_number" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['sort_number'])">
                                            <label for="input-sort_number" class="text-danger">{$message['sort_number']}</label>
                                        </if>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</block>
<block name="appendJs">
    <script  src="__PUBLIC__/Back/validate/jquery.validate.min.js"></script>
    <script  src="__PUBLIC__/Back/validate/additional-methods.min.js"></script>
    <script  src="__PUBLIC__/Back/validate/localization/messages_zh.min.js"></script>
    <script  type="text/javascript">

        $(function (){
            $('#form-brand').validate({
                rules:{
                    title:{
                        required:true,
                        remote:{
                            url:$('#input-title').data('remoteurl'),
                            data:{
                                attribute_id:$('#input-attribute_id').val()
                            }
                        }
                    },
                    site:{
                        url:true,
                    },
                    sort_number:{
                        required:true,
                        digits:true,
                    }
                },
                messages:{
                    title:{
                        required:'请填写属性名',
                        remote:'属性名已经存在',
                    },
                    site:{
                        url:'网址不正确',
                    },
                    sort_number:{
                        required:'请填写排序',
                        digits:'使用数字',
                    }
                },
                errorClass:'text-danger',
            });
        });

    </script>
    <script>
        $(function(){
            if ($('#input-input_type_id').find('option:selected:eq(0)').text() == 'select-multi') {
                $('#row-options').show();
            } else {
                $('#row-options').hide();
            }
            $('#input-input_type_id').change(function (evt) {
                if ($(this).find('option:selected:eq(0)').text()== 'select-multi'){
                    $('#row-options').show();
                }else{
                    $('#row-options').hide();
                }
            });

           var optionIndex = $('#table-options>tbody>tr').size() - 1 ;
           $('#button-add').click(function(evt){
               var html =  '<tr>' +
                   '<td class="text-left">' +
                   '<input name="option[' + optionIndex +
                   '][option_value]" value="' + $('#option-option_value').val() +
                   '" placeholder="选项" class="form-control" type="text">' +
                   '</td>' +
                   '<td class="text-left">' +
                   '<input name="option[' + optionIndex +
                   '][sort_number]" value="' + $('#option-sort_number').val() +
                   '" placeholder="排序" class="form-control" type="text">' +
                   '</td>' +
                   '<td class="text-right">' +
                   '<button class="btn btn-default">删除</button>' +
                   '</td>' +
                   '</tr>';
               $('#table-options>tbody').append(html);

               $('#option-option_value').val('')
               $('#option-sort_number').val(0)
            ++ optionIndex;
               evt.preventDefault();
           });
        });
    </script>



</block>
