<extend name="Common/back"/>
<block name="content">
    <div id="content">
        <div class="page-header">
            <div class="container-fluid">
                <div class="pull-right">
                    <button type="submit" form="form-set" data-toggle="tooltip" title="保存" class="btn btn-primary">
                        <i class="fa fa-save"></i>
                    </button>
                    <a href="{:U('list')}" data-toggle="tooltip" title="取消" class="btn btn-default">
                        <i class="fa fa-reply"></i>
                    </a>
                </div>
                <h1>商品</h1>
                <ul class="breadcrumb">
                    <li>
                        <a href="">首页</a>
                    </li>
                    <li>
                        <a href="">商品</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="container-fluid">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <i class="fa fa-pencil"></i>
                        编辑商品
                    </h3>
                </div>
                <div class="panel-body">
                    <form action="__SELF__" method="post" enctype="multipart/form-data" id="form-set" class="form-horizontal">
                        <if condition="isset($data['goods_id'])" >
                            <input type="hidden" name="goods_id" value="{$data['goods_id']}" id="input-goods_id">
                        </if>

                        <ul class="nav nav-tabs">
                            <li>
                                <a href="#tab-general" data-toggle="tab">基本信息</a>
                            </li>
                            <li>
                                <a href="#tab-description" data-toggle="tab">商品描述</a>
                            </li>
                            <li>
                                <a href="#tab-seo" data-toggle="tab">SEO项目</a>
                            </li>
                            <li>
                                <a href="#tab-links" data-toggle="tab">关联项目</a>
                            </li>
                            <li>
                                <a href="#tab-attribute" data-toggle="tab">属性</a>
                            </li>
                            <li>
                                <a href="#tab-discount" data-toggle="tab">促销活动</a>
                            </li>
                            <li>
                                <a href="#tab-image" data-toggle="tab">图片设置</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="tab-general">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-name">商品名称</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="name" value="{$data['name']}" placeholder="商品名称" id="input-name" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['name'])">
                                            <label for="input-name" class="text-danger">{$message['name']}</label>
                                        </if>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-image">图片</label>
                                    <div class="col-sm-6">
                                        <input type="hidden" name="image" id="input-image-value" value="{$data['image']}">
                                        <input type="hidden" name="image_thumb" id="input-image_thumb-value"  value="{$data['image_thumb']}">
                                        <span class="btn btn-success fileinput-button">
                                            <i class="glyphicon glyphicon-plus"></i>
                                            <span>添加文件</span>

                                                <input id="input-image" name="image" type="file" data-uploadurl="{:U('upload',['type'=>'goods'])}">
                                        </span>
                                        <if condition="isset($message['image'])">
                                            <label for="input-image" class="text-danger">{$message['image']}</label>
                                        </if>
                                    </div>
                                    <div class="col-sm-4">
                                        <img src="__PUBLIC__/Thumb/{$data['image_thumb']}" alt="" id="image-show" class="img-thumbnail" style="max-height: 50px; <if condition="$data['image'] eq ''">display:none;</if>" />
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-quantity">库存</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="quantity" value="{$data['quantity']|default=1}" id="input-quantity" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['quantity'])">
                                            <label for="input-quantity" class="text-danger">{$message['quantity']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-sku_id">库存单位</label>
                                    <div class="col-sm-10">
                                         <select  name="sku_id" id="input-sku_id" class="form-control" data-checkl="{:U('check',['field'=>'sku_id'])}" >
                                            <volist name="sku_list" id="sku">
                                                <option value="{$sku['sku_id']}" <if condition="$data['sku_id'] eq $sku['sku_id']" >selected</if> >
                                                {$sku['title']}
                                                </option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['sku_id'])">
                                            <label for="input-sku_id" class="text-danger">{$message['sku_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-upc">商品代码</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="upc" value="{$data['upc']}" placeholder="商品代码" id="input-upc" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['upc'])">
                                            <label for="input-upc" class="text-danger">{$message['upc']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-price">本店售价</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="price" value="{$data['price']|default=0}" placeholder="本店售价" id="input-price" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['price'])">
                                            <label for="input-price" class="text-danger">{$message['price']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-market_price">市场价</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="market_price" value="{$data['market_price']|default=0}" placeholder="市场价" id="input-market_price" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['market_price'])">
                                            <label for="input-market_price" class="text-danger">{$message['market_price']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-tax_id">税类型</label>
                                    <div class="col-sm-10">
                                        <select  name="tax_id" id="input-tax_id" class="form-control" data-checkl="{:U('check',['field'=>'tax_id'])}" >
                                            <volist name="tax_list" id="tax">
                                                <option value="{$tax['tax_id']}" <if condition="$data['tax_id'] eq $tax['tax_id']" >selected</if> >
                                                {$tax['title']}
                                                </option>
                                            </volist>
                                        </select><if condition="isset($message['tax_id'])">
                                            <label for="input-tax_id" class="text-danger">{$message['tax_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-minimum">最小起订</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="minimum" value="{$data['minimum']|default=0}" placeholder="最小起订" id="input-minimum" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['minimum'])">
                                            <label for="input-minimum" class="text-danger">{$message['minimum']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-subtract">是否减少库存</label>
                                    <div class="col-sm-10">
                                        <input type="checkbox" name="subtract" id="input-subtract" class="form-control" <if condition="$data['subtract'] eq ''"> checked</if> />
                                        <if condition="isset($message['subtract'])">
                                            <label for="input-subtract" class="text-danger">{$message['subtract']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-stock_status_id">库存状态</label>
                                    <div class="col-sm-10">
                                        <select  name="stock_status_id" id="input-stock_status_id" class="form-control" data-checkl="{:U('check',['field'=>'stock_status_id'])}" >
                                            <volist name="stock_status_list" id="stock_status">
                                                <option value="{$stock_status['stock_status_id']}" <if condition="$data['stock_status_id'] eq $stock_status['stock_status_id']" >selected</if> >
                                                {$stock_status['title']}
                                                </option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['stock_status_id'])">
                                            <label for="input-stock_status_id" class="text-danger">{$message['stock_status_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-shipping">是否允许配送</label>
                                    <div class="col-sm-10">
                                        <input type="checkbox" name="shipping" id="input-shipping" class="form-control" <if condition="$data['shipping'] eq ''"> checked</if> />
                                        <if condition="isset($message['shipping'])">
                                            <label for="input-shipping" class="text-danger">{$message['shipping']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-date_available">供货日期</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="date_available" value="{$data['date_available']|default=''}" placeholder="供货日期" id="input-date_available" class="form-control"  />
                                        <if condition="isset($message['date_available'])">
                                            <label for="input-date_available" class="text-danger">{$message['date_available']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-length">长</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="length" value="{$data['length']|default=0}" placeholder="长" id="input-length" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['length'])">
                                            <label for="input-length" class="text-danger">{$message['length']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-width">宽</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="width" value="{$data['width']|default=0}" placeholder="宽" id="input-width" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['width'])">
                                            <label for="input-width" class="text-danger">{$message['width']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-height">高</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="height" value="{$data['height']|default=0}" placeholder="高" id="input-height" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['height'])">
                                            <label for="input-height" class="text-danger">{$message['height']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-length_unit_id">长度单位</label>
                                    <div class="col-sm-10">
                                        <select  name="length_unit_id" id="input-length_unit_id" class="form-control" data-checkl="{:U('check',['field'=>'length_unit_id'])}" >
                                            <volist name="length_unit_list" id="length_unit">
                                                <option value="{$length_unit['length_unit_id']}" <if condition="$data['length_unit_id'] eq $length_unit['length_unit_id']" >selected</if> >
                                                {$length_unit['title']}
                                                </option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['length_unit_id'])">
                                            <label for="input-length_unit_id" class="text-danger">{$message['length_unit_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-weight">重量</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="weight" value="{$data['weight']|default=0}" placeholder="重量" id="input-weight" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['weight'])">
                                            <label for="input-weight" class="text-danger">{$message['weight']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-weight_unit_id">重量单位</label>
                                    <div class="col-sm-10">
                                        <select  name="weight_unit_id" id="input-weight_unit_id" class="form-control"  >
                                            <volist name="weight_unit_list" id="weight_unit">
                                                <option value="{$weight_unit['weight_unit_id']}" <if condition="$data['weight_unit_id'] eq $weight_unit['weight_unit_id']" >selected</if> >
                                                {$weight_unit['title']}
                                                </option>
                                            </volist>
                                        </select>
                                         <if condition="isset($message['weight_unit_id'])">
                                            <label for="input-weight_unit_id" class="text-danger">{$message['weight_unit_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-status">收否可用</label>
                                    <div class="col-sm-10">
                                        <input type="checkbox" name="status" id="input-status" class="form-control" <if condition="$data['status'] eq ''"> checked</if> />
                                        <if condition="isset($message['status'])">
                                            <label for="input-status" class="text-danger">{$message['status']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">

                                    <label class="col-sm-2 control-label" for="input-deleted">是否被删除</label>
                                    <div class="col-sm-10">
                                        <input type="checkbox" name="deleted" id="input-deleted" class="form-control" <if condition="$data['deleted'] eq 1"> checked</if> />
                                        <if condition="isset($message['deleted'])">
                                            <label for="input-deleted" class="text-danger">{$message['deleted']}</label>
                                        </if>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-sort_number">排序</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="sort_number" value="{$data['sort_number']}" placeholder="排序" id="input-sort_number" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['sort_number'])">
                                            <label for="input-sort_number" class="text-danger">{$message['sort_number']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-updated_at">修改时间</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="updated_at" value="{$data['updated_at']}" placeholder="修改时间" id="input-updated_at" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['updated_at'])">
                                            <label for="input-updated_at" class="text-danger">{$message['updated_at']}</label>
                                        </if>
                                    </div>
                                </div>


                            </div>
                            <div class="tab-pane " id="tab-seo">

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-meta_title">META标题</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="meta_title" value="{$data['meta_title']}" placeholder="META标题" id="input-meta_title" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['meta_title'])">
                                            <label for="input-meta_title" class="text-danger">{$message['meta_title']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-meta_keywords">META关键字</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="meta_keywords" value="{$data['meta_keywords']}" placeholder="META关键字" id="input-meta_keywords" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['meta_keywords'])">
                                            <label for="input-meta_keywords" class="text-danger">{$message['meta_keywords']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-meta_description">META描述</label>
                                    <div class="col-sm-10">
                                        <input type="text" name="meta_description" value="{$data['meta_description']}" placeholder="META描述" id="input-meta_description" class="form-control" data-remoteurl="{:U('ajax')}" />
                                        <if condition="isset($message['meta_description'])">
                                            <label for="input-meta_description" class="text-danger">{$message['meta_description']}</label>
                                        </if>
                                    </div>
                                </div>

                            </div>
                            <div class="tab-pane " id="tab-description">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-description">商品描述</label>
                                    <div class="col-sm-10">
                                        <textarea  name="description"  id="input-description" class="form-control"
                                                   data-uploadurl="{:U('upload', ['type'=>'description'])}"
                                        >{$data['description']}</textarea>
                                        <if condition="isset($message['description'])">
                                            <label for="input-description" class="text-danger">{$message['description']}</label>
                                        </if>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane" id="tab-links">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-brand_id">品牌</label>
                                    <div class="col-sm-10">
                                        <select  name="brand_id" id="input-brand_id" class="form-control"  >
                                            <volist name="brand_list" id="brand">
                                                <option value="{$brand['brand_id']}" <if condition="$data['brand_id'] eq $brand['brand_id']" >selected</if> >
                                                {$brand['title']}
                                                </option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['brand_id'])">
                                            <label for="input-brand_id" class="text-danger">{$message['brand_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-category_id">主要分类</label>
                                    <div class="col-sm-10">
                                        <select name="category_id" id="input-category_id" class="form-control">
                                            <volist name="category_list" id="category">
                                                <option value="{$category['category_id']}" <if condition="$category['category_id'] eq $data['category_id']">selected</if>>{:str_repeat('--',$category['deep'])}{$category['category_title']}</option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['category_id'])">
                                            <label for="input-category_id" class="text-danger">{$message['category_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-category_list">扩展分类</label>
                                    <div class="col-sm-10">
                                        <select name="category_list[]" id="input-category_list" multiple size="10" class="form-control">
                                            <volist name="category_list" id="category">
                                                <option value="{$category['category_id']}" <if condition="in_array($category['category_id'],$category_linked)">selected</if>>{:str_repeat('--',$category['deep'])}{$category['category_title']}</option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['category_id'])">
                                            <label for="input-category_list" class="text-danger">{$message['category_id']}</label>
                                        </if>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane " id="tab-attribute">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="input-type_id">类型</label>
                                    <div class="col-sm-10">
                                        <select name="type_id" id="input-type_id" class="form-control" data-attributeurl="{:U('attribute')}" >
                                            <option value="0">请选择类型</option>
                                            <volist name="type_list" id="type">
                                                <option value="{$type['type_id']}" <if condition="$type['type_id'] eq $data['type_id']">selected</if> >
                                                {$type['type_title']}
                                                </option>
                                            </volist>
                                        </select>
                                        <if condition="isset($message['type_id'])">
                                            <label for="input-type_id" class="text-danger">{$message['type_id']}</label>
                                        </if>
                                    </div>
                                </div>
                                <volist name="attribute_list" id="attribute">
                                    <div class="form-group">
                                        <label for="input-attribute-{$key}" class="col-sm-2 control-label">
                                            {$attribute['attribute_title']}
                                        </label>
                                        <div class="col-sm-1 text-center">
                                            <label class="control-label">
                                                <input type="checkbox" name="goods_attribute[{$key}][product_option]" value="1" class="form-control" <if condition="$attribute['goods_attribute']['product_option'] eq '1'">checked</if>>
                                            </label>
                                        </div>
                                        <div class="col-sm-9">
                                            <if condition="isset($attribute['goods_attribute'])">
                                                <input type="hidden" value="{$attribute['goods_attribute']['goods_attribute_id']}" name="goods_attribute[{$key}][goods_attribute_id]">
                                            </if>
                                            <input type="hidden" name="goods_attribute[{$key}][attribute_id]" value="{$attribute['goods_attribute']['attribute_id']}" />
                                            <switch name="attribute['type_title']">
                                                <case value="text">
                                                    <input type="text" name="goods_attribute[{$key}][value]" value="{$attribute['goods_attribute']['value']}" class="form-control">
                                                </case>
                                                <case value="select-multi">
                                                    <select name="goods_attribute[{$key}][value][]" id="input-attribute-{$key}" class="form-control" multiple >
                                                        <volist name="attribute['option_list']" id="option">
                                                            <option value="{$option['attribute_option_id']}" <if condition="in_array($option['attribute_option_id'],$attribute['goods_attribute']['selected_attribute_option_id_list'])">selected</if>>
                                                            {$option['option_value']}
                                                            </option>
                                                        </volist>
                                                    </select>
                                                </case>
                                            </switch>
                                        </div>
                                    </div>
                                </volist>
                            </div>
                            <div class="tab-pane" id="tab-image">
                                <div class="table-responsive">
                                    <table id="table-galleries" class="table table-striped table-bordered table-hover" data-removeurl="{:U('remove')}">
                                        <thead>
                                        <tr>
                                            <td class="text-left">图片</td>
                                            <td class="text-left">描述</td>
                                            <td class="text-right">排序</td>
                                            <td></td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <volist name="gallery_list" id="gallery">
                                            <tr id="image-row-{$key}">
                                                <td class="text-left">
                                                    <input  type="hidden" name="galleries[{$key}][gallery_id]" value="{$gallery['gallery_id']}">
                                                    <img src="__PUBLIC__/Thumb/{$gallery['image_small']}" alt="NO-IMG" title="">
                                                </td>
                                                <td class="text-right">
                                                    <input name="galleries[{$key}][intro]" value="{$gallery['intro']}" placeholder="描述" class="form-control" type="text">
                                                </td>
                                                <td class="text-right">
                                                    <input name="galleries[{$key}][sort_number]" value="{$gallery['sort_number']}" placeholder="排序" class="form-control valid" aria-invalid="false" type="text">
                                                </td>
                                                <td class="text-left">
                                                    <button type="button" data-toggle="tooltip" title="" class="btn btn-danger remove-button" data-original-title="移除" data-gallery_id="{$gallery['gallery_id']}"><i class="fa fa-minus-circle"></i></button>
                                                </td>
                                            </tr>
                                        </volist>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td colspan="4" class="text-right">
                                                    <span class="btn btn-success fileinput-button">
                                                        <i class="glyphicon glyphicon-plus"></i>
                                                        <span>选择图片</span>
                                                            <input id="input-galleries" name="galleries" type="file" multiple data-uploadurl="{:U('upload', ['type'=>'gallery'])}">
                                                    </span>
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</block>
<block name="appendCss">
    <link href="__PUBLIC__/Back/datetimepicker/bootstrap-datetimepicker.min.css" type="text/css" rel="stylesheet" media="screen" />
    <link href="__PUBLIC__/Back/summernote/summernote.css" type="text/css" rel="stylesheet" media="screen" />
    <link href="__PUBLIC__/Back/jqueryFileUpload/css/jquery.fileupload.css" type="text/css" rel="stylesheet" media="screen" />
    <link href="__PUBLIC__/Back/jqueryFileUpload/css/jquery.fileupload-ui.css" type="text/css" rel="stylesheet" media="screen" />

</block>

<block name="appendJs">
    <script src="__PUBLIC__/Back/validate/jquery.validate.min.js"></script>
    <!--<script src="__PUBLIC__/Back/validate/jquery.validate.js"></script>-->
    <script src="__PUBLIC__/Back/validate/additional-methods.min.js"></script>
    <script src="__PUBLIC__/Back/validate/localization/messages_zh.min.js"></script>
    <script src="__PUBLIC__/Back/datetimepicker/moment.js"></script>
    <script src="__PUBLIC__/Back/datetimepicker/bootstrap-datetimepicker.min.js"></script>
    <script src="__PUBLIC__/Back/summernote/summernote.js"></script>
    <script src="__PUBLIC__/Back/jqueryFileUpload/js/vendor/jquery.ui.widget.js"></script>
    <script src="__PUBLIC__/Back/jqueryFileUpload/js/jquery.fileupload.js"></script>


    <script>
        //日期插件
        $(function(){
            $('#input-date_available').datetimepicker({
                pickDate:true,
                pickTime:false,
                format:'YYYY-MM-DD',
            });
        });
    </script>
    <script>
        //描述图片上传返显
        $(function () {
            var editor=  $('#input-description').summernote({
                height:300,
                callbacks:{
                    onImageUpload:function(fileList){
                        var data = new FormData();
                        data.append('image',fileList[0]);
                        $.ajax({
                            type:'post',
                            url:$('#input-description').data('uploadurl'),
                            data:data,//{key:value}=>key=value&key=value
                            contentType:false,
                            processData:false,
                            success:function(response){
                                if (response.error===0){
                                    editor.summernote('insertImage',$('body').data('root')+'Upload/'+response.image);
                                }
                            }
                        });
                    }
                }
            });
        });
    </script>
    <script>
        //validate判断合理性
        $(function () {
            $('#form-set').validate({
                rules:{
                    sku_id:{
                        remote:$('#input-sku_id').data('checkl'),
                    },
                    tax_id:{
                        remote:$('#input-tax_id').data('checkl'),
                    },
                    stock_status_id:{
                        remote:$('#input-stock_status_id').data('checkl'),
                    },
                    length_unit_id:{
                        remote:$('#input-length_unit_id').data('checkl'),
                    }
                },
                messages:{
                    sku_id:{
                        remote:'选择合理的库存单位',
                    },
                    tax_id:{
                        remote:'选择合理的税类型',
                    },
                    stock_status_id:{
                        remote:'选择合理的库存',
                    },
                    length_unit_id:{
                        remote:'选择合理的长度单位',
                    }
                },

                errorClass:'text-danger',
            });
            $('#input-sku_id').change(function(evt) {
                validator.element($(this));
            });
            $('#input-tax_id').change(function(evt) {
                validator.element($(this));
            });
            $('#input-stock_status_id').change(function(evt) {
                validator.element($(this));
            });
            $('#input-length_unit_id').change(function(evt) {
                validator.element($(this));
            });
        });
    </script>
    <script>
        //上传文件，返显
        $(function () {
            $('#input-image').fileupload({
                    url:$('#input-image').data('uploadurl'),
                dataType:'json',
                done:function(evt,response){
                    var data= response.result;
                    console.log(data);
                    if(data.error === 0){
                        $('#image-show').attr('src', $('body').data('public') + 'Thumb/' + data.image_thumb).show();
                        $('#input-image-value').val(data.image);
                        $('#input-image_thumb-value').val(data.image_thumb);
                    }
                }
            });
        });

    </script>
    <script>
        //删除相册和记录
        //增加相册和上传
        $(function () {
                $('#table-galleries').delegate('button.remove-button','click',function (evt) {
                    var currButton = $(this);
                    //ajax删除服务器上的记录和图像资源
                    var url = $('#table-galleries').data('removeurl');
                    var data = {
                        gallery_id:currButton.data('gallery_id'),
                        image_small:currButton.data('image_small')
                    };
                    $.post(url,data,function (response) {
                        currButton.parents('tr').remove();
                    },'json');
                    evt.preventDefault();
                });

            //初始化一个变量
            var galleryIndex = $('#table-galleries>tbody>tr').size();
           $('#input-galleries').fileupload({
                  url:$('#input-galleries').data('uploadurl'),
               dataType:'json',
               done:function (evt,response) {
                   var data= response.result;
                   if(data.error === 0){
                        var html = '<tr id="image-row">'+
                                '<td class="text-left">'+
'<input type="hidden" name="galleries['+ galleryIndex +'][image]" value="'+data.image +'">'+
'<input type="hidden" name="galleries['+ galleryIndex +'][image_big]" value="'+data.image_big +'">'+
'<input type="hidden" name="galleries['+ galleryIndex +'][image_medium]" value="'+data.image_medium +'">'+
'<input type="hidden" name="galleries['+ galleryIndex +'][image_small]" value="'+data.image_small +'">'+
                                '<img src="'+$('body').data('public')+'Thumb/'+data.image_small+
                                '" alt="No-IMG" title=""> '+
                                '</td>'+
                                '<td class="text-right">'+
                                '<input name="galleries['+galleryIndex+'][intro]" value="" placeholder="描述" class="form-control" type="text">'+
                                '</td>'+
                                '<td class="text-right"> '+
                                '<input name="galleries['+galleryIndex+'][sort_number]" value="0" placeholder="排序" class="form-control" type="text"> '+
                                '</td>'+
                                '<td class="text-left"> '+
                                '<button type="button" data-toggle="tooltip" title="移除" class="btn btn-danger remove-button"'+' data-image_small="' + data.image_small+'"' +'><i class="fa fa-minus-circle"></i></button> '+
                                '</td>'+'</tr>';
                        $('#table-galleries').append(html);
                        ++ galleryIndex;
                   }
               }
           });
        });
    </script>
    <script>
        $(function () {
           $('#input-type_id').change(function (evt) {
               var currSelect = $(this);
               if ('0' === currSelect.val()){

               }else{
                   var url = currSelect.data('attributeurl');
                   var data={
                       type_id :currSelect.val(),
                   };
                   $.get(url,data,function (response) {
                       if (0 === response.error){
                         var attributeIndex = 0;
                         var html='';
                           $.each(response.data, function(i, attribute) {
                               html += '<div class="form-group">' +
                                   '<label class="col-sm-2 control-label" for="input-attribute-10">' + attribute.attribute_title +
                                   '</label>';
                               html += '<div class="col-sm-1 text-center">' +
                                   '<label class="control-label">' +
                                   '<input name="goods_attribute['+attributeIndex+'][product_option]" value="1" class="form-control" type="checkbox">' +
                                   '</label></div>';
                               html += '<div class="col-sm-9">' +
                                   '<input type="hidden" name="goods_attribute[' + attributeIndex +
                                   '][attribute_id]" value="' + attribute.attribute_id +
                                   '">';
                               // 依据attribute.type_title来完成处理
                               switch (attribute.type_title) {
                                   case 'text':
                                       html += '<input name="goods_attribute[' + attributeIndex +
                                           '][value]" value="" placeholder="属性值" id="input-attribute-' + attributeIndex +
                                           '" class="form-control" type="text">';
                                       break;

                                   case 'select-multi':
                                       html += '<select multiple name="goods_attribute[' + attributeIndex + '][value][]" id="input-attribute-' + attributeIndex +
                                           '" class="form-control">';
                                       $.each(attribute.option_list, function(i, option){
                                           html += '<option value="' + option.attribute_option_id + '">' + option.option_value + '</option>';
                                       });
                                       html += '</select>';
                                       break;
                               }


                               html += '</div></div>';

                               // 索引值 递增
                               ++ attributeIndex;
                           });
                         $('#tab-attribute>div.form-group:gt(0)').remove();
                         $('#tab-attribute').append(html);
                       }
                   },'json');
               }
               evt.preventDefault();
           }) ;
        });
    </script>
</block>
